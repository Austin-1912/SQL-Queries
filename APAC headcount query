select * from WUDNA.SUMMARY_GEN.WUDNA_TXN_MASTER_ANALYTICS_VW where FEE_SEGMENT_USED='N7' limit 100;

select * from WUDNA.SUMMARY_GEN.WUDNA_TXN_MASTER_ANALYTICS_VW limit 100;

create or replace table CAR_645_AU_N7_PRICING_TXN_DETAILS as 
select 
    SNDCUSTOMER_KEY,
    TXN_ID,
    RCVPAYING_DATETIME,
    SNDCOUNTRY_CODE,
    SEND_COUNTRY_NAME,
    RCVCOUNTRY_CODE,
    RCV_COUNTRY_NAME,
    FEE_SEGMENT_USED,
    FX_SEGMENT_USED,
    SNDPRINCIPAL_USD,
    case when PRICING_CHANNEL in ('WEB','APP') then 'DIGITAL'
    when PRICING_CHANNEL in ('POS','AIR','TMT') then 'RETAIL'
    ELSE 'OTHERS' END AS RETAIL_DIGITAL_FLAG
FROM
    WUDNA.SUMMARY_GEN.WUDNA_TXN_MASTER_ANALYTICS_VW
where
    FEE_SEGMENT_USED='N7'
AND
    FX_SEGMENT_USED='N7'
AND
    SNDCOUNTRY_CODE in ('AU')
AND
    RCVCOUNTRY_CODE in ('BG','BD','PK','NP','CO','FJ');

select count(*), count(distinct sndcustomer_key) from CAR_645_AU_N7_PRICING_TXN_DETAILS;--386,948 35,044


select
    RCV_COUNTRY_NAME, count(*), count(distinct sndcustomer_key) from CAR_645_AU_N7_PRICING_TXN_DETAILS group by 1;

select
    RETAIL_DIGITAL_FLAG, count(*), count(distinct sndcustomer_key) from CAR_645_AU_N7_PRICING_TXN_DETAILS group by 1;

select min(rcvpaying_datetime), max(rcvpaying_datetime) from CAR_645_AU_N7_PRICING_TXN_DETAILS;-- 21st March 2023 to till date



select
    SEND_COUNTRY_NAME,
    RCV_COUNTRY_NAME,
    RETAIL_DIGITAL_FLAG,
    FEE_SEGMENT_USED as PRICING_SEGMENT,
    
    date_trunc(MONTH,RCVPAYING_DATETIME) as MTH_YR,
    count(distinct sndcustomer_key) as customer_count,
    count(txn_id) as total_txns,
    sum(SNDPRINCIPAL_USD) as total_principal
from
   CAR_645_AU_N7_PRICING_TXN_DETAILS
group by ALL; 


select
    SNDCUSTOMER_KEY,
    SEND_COUNTRY_NAME,
    RCV_COUNTRY_NAME,
    count(txn_id)
from
    CAR_645_AU_N7_PRICING_TXN_DETAILS
where
    RCVCOUNTRY_CODE in ('PK','NP','CO')
group by ALL;
