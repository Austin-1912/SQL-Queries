CREATE OR REPLACE TABLE CAR_782_TXN_BASE AS
SELECT
    DATE_TRUNC('MONTH', txn.rcvpaying_datetime) AS mth_yr,
    txn.SNDCOUNTRY_CODE AS snd_country,
    txn.RCVCOUNTRY_CODE AS rcv_country,
    CONCAT(txn.SNDCOUNTRY_CODE, '-', txn.RCVCOUNTRY_CODE) AS corridor,
    txn.SNDCUSTOMER_KEY AS GID,
    txn.SNDPRINCIPAL_USD AS Principal,
    CASE
        WHEN UPPER(txn.channel) IN ('WEB','APP') THEN 'DIGITAL'
        WHEN UPPER(txn.channel) IN ('POS','TMT','AIR') THEN 'RETAIL'
        ELSE 'OTHER'
    END AS channel_group,
    txn.sndagent_number, txn.agent_naid
    cm.nationality
FROM WUDNA.SUMMARY_GEN.WUDNA_TXN_MASTER_ANALYTICS_VW txn
    JOIN WUDNA.SUMMARY_GEN.WUDNA_CUSTOMER_MASTER_VW cm
WHERE txn.rcvpaying_datetime >= '2025-01-01'
  AND txn.rcvpaying_datetime < DATE_TRUNC('DAY', CURRENT_DATE)
  AND txn.SNDCOUNTRY_CODE IN ('MY','SG');
