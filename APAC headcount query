CREATE OR REPLACE TABLE CAR_824_GID_ENRICHED AS 
SELECT
    gc.MTH_YR,
    gc.snd_country,
    dc.corridor,
    gc.GID,
    gc.digital_txn,
    gc.retail_txn,
    gc.total_transactions,
    dp.PAYOUT_TYPE AS dominant_payout_type,
    dpb.PPT_bucket AS PPT_bucket,
    CASE WHEN gc.digital_txn > 0 THEN 1 ELSE 0 END AS has_digital,
    CASE WHEN gc.retail_txn  > 0 THEN 1 ELSE 0 END AS has_retail,
    CASE
        WHEN gc.digital_txn > 0 AND gc.retail_txn > 0 THEN 'OMNICHANNEL'
        WHEN gc.digital_txn > 0 AND gc.retail_txn = 0 THEN 'DIGITAL_ONLY'
        WHEN gc.retail_txn  > 0 AND gc.digital_txn = 0 THEN 'RETAIL_ONLY'
        ELSE 'OTHER'
    END AS customer_type,
    CASE 
        WHEN gc.total_transactions = 1 THEN 'A.1x'
        WHEN gc.total_transactions = 2 THEN 'B.2x'
        WHEN gc.total_transactions = 3 THEN 'C.3x'
        WHEN gc.total_transactions >= 4 AND gc.total_transactions <= 7 THEN 'D.4x - 7x'
        WHEN gc.total_transactions >= 8 AND gc.total_transactions <= 12 THEN 'E.8x - 12x'
        WHEN gc.total_transactions > 12 THEN 'F.12x+'
        ELSE 'Unknown'
    END AS TPC_bucket,
    b.nationality AS customer_nationality,
    CASE
        WHEN b.nationality IS NULL THEN 'UNKNOWN'
        WHEN nr.nat_rank <= 5 THEN b.nationality
        ELSE 'OTHERS'
    END AS top_nationality,
    ROUND(c.IPF,2) as IPF
FROM CAR_824_GID_CHANNELS AS gc
LEFT JOIN WUDNA.CEX_SANDBOX.YN_VA_KPI_2020_OUTPUT_ENGAGEMENT_CUST_LEVEL c
ON gc.GID = c.SNDCUSTOMER_KEY AND gc.MTH_YR = c.MTH_YR
LEFT JOIN CAR_824_GID_DOMINANT_CORRIDOR AS dc
    ON gc.GID = dc.gid
LEFT JOIN CAR_824_DOMINANT_PAYOUT dp
    ON gc.gid = dp.gid
LEFT JOIN CAR_824_DOMINANT_PPT_BUCKET dpb
    ON gc.gid = dpb.gid
LEFT JOIN (
    SELECT DISTINCT GID, snd_country, nationality
    FROM CAR_824_TXN_BASE
) b
    ON gc.snd_country = b.snd_country AND gc.gid = b.gid
LEFT JOIN CAR_824_NATIONALITY_RANK nr
    ON dc.corridor = nr.corridor AND b.nationality = nr.nationality;

IPF is the frequency the customer transacts in like every 7 days or 30 days and so on so i have to create a bucket 
for the IPF as well instead of just bringing it directly. IPF contains the number of days like 7.00, 30.12 and so on.
So create for me weekly , monthly, quarterly, half yearly and yearly. 
