SUM(Case when SUBSTR(ACTIVITY_CODE,3,1) = 'P' THEN (TOTAL_EMAILS_SENT) ELSE 1 END) as communications_sent,

 
count(case when EMAILS_UN_DELIVERED > 0 then 1 end) as Communications_undelivered,
 
count(case when EMAILS_OPENED_ATLEAST_ONCE_WITHIN_7_DAYS_OF_COMMUNICATION > 0 then 1 end) as communications_OPENED_ATLEAST_ONCE_WITHIN_7_DAYS_OF_COMMUNICATION,

count(case when EMAILS_WITH_ATLEAST_ONE_LINK_CLICK_WITHIN_7_DAYS_OF_COMMUNICATION > 0  then 1 end) as communications_WITH_ATLEAST_ONE_LINK_CLICK_WITHIN_7_DAYS_OF_COMMUNICATION,
 
SUM(Case when SUBSTR(ACTIVITY_CODE,3,1) IN ('P','E','W') THEN (TOTAL_EMAILS_SENT) END) as OPEN_communications_sent,
 
SUM(Case when SUBSTR(ACTIVITY_CODE,3,1) NOT IN ('P') THEN (TOTAL_EMAILS_SENT) END) as CLICK_communications_sent,
 
count(case when retail_txns_7days > 0 then 1 end ) as test_communications_with_atleast_1_retail_txn_7days,
 
count(case when digital_txns_7days > 0 then 1 end ) as test_communications_with_atleast_1_digital_txn_7days,
 
count(case when txns_7days > 0 then 1 end ) as test_communications_with_atleast_1_txn_7days,
 
count(case when lapsed='Y' and txns_7days > 0 then 1 end ) as test_communications_winbacks_7DAYS,
 
count(case when emails_un_delivered=0 

			and lapsed='Y' 

			AND ((SUBSTR(ACTIVITY_CODE,3,1) IN ('P') AND EMAILS_OPENED_ATLEAST_ONCE_WITHIN_7_DAYS_OF_COMMUNICATION > 0 )

				or

				(SUBSTR(ACTIVITY_CODE,3,1) IN ('E','S','I','C','W') AND  EMAILS_WITH_ATLEAST_ONE_LINK_CLICK_WITHIN_7_DAYS_OF_COMMUNICATION > 0))

					then 1 end ) as test_lapsed_only_delivered_opened_clicked_7days,
 
TOTAL OPEN FOR PUSH + TOTAL CLICKS
 
