reate or replace table Country_Packet_DATA_AGGREGATED_Dimension_Base as
SELECT distinct
REGION,
COUNTRY_NAME,
MTH_YR,

RFM_PERSONA,
DOMINANT_CORRIDOR,
DOMINANT_SNDCOUNTRY_NAME,
DOMINANT_RCVCOUNTRY_NAME,
DOMINANT_AGENT,
DOMINANT_AGENT_DMA,
DOMINANT_RCV_AGENT,
DOMINANT_CHANNEL,
FLAG_CONTACTABLE,
EMAIL_SMS_MARKETABLE,
RETAIL_DIGITAL_FLAG,
DOMINANT_ATTRBUTE_FUNDS_IN,
DOMINANT_ATTRBUTE_FUNDS_OUT,
R12_active_breakup,
MYWU_status_1,
DOMINANT_CORRIDOR_TYPE_1
from Country_Packet_CUST_LEVEL_DATA_AGGREGATED_R12
UNION
select distinct 
REGION,
COUNTRY_NAME,
MTH_YR,
RFM_PERSONA,
DOMINANT_CORRIDOR,
DOMINANT_SNDCOUNTRY_NAME,
DOMINANT_RCVCOUNTRY_NAME,
DOMINANT_AGENT,
DOMINANT_AGENT_DMA,
DOMINANT_RCV_AGENT,
DOMINANT_CHANNEL,
FLAG_CONTACTABLE,
EMAIL_SMS_MARKETABLE,
RETAIL_DIGITAL_FLAG,
DOMINANT_ATTRBUTE_FUNDS_IN,
DOMINANT_ATTRBUTE_FUNDS_OUT,
R12_active_breakup,
MYWU_STATUS_1,
DOMINANT_CORRIDOR_TYPE_1
from Country_Packet_CUST_LEVEL_DATA_AGGREGATED_PR12;







create or replace table Country_Packet_DATA_AGGREGATED_backup clone Country_Packet_DATA_AGGREGATED;


create or replace table Country_Packet_DATA_AGGREGATED as
select 
a.REGION,
a.COUNTRY_NAME,
a.MTH_YR,
a.RFM_PERSONA,
a.DOMINANT_CORRIDOR,
a.DOMINANT_SNDCOUNTRY_NAME,
a.DOMINANT_RCVCOUNTRY_NAME,
a.DOMINANT_AGENT,
a.DOMINANT_AGENT_DMA,
a.DOMINANT_RCV_AGENT,
a.DOMINANT_CHANNEL,
a.FLAG_CONTACTABLE,
a.EMAIL_SMS_MARKETABLE,
a.RETAIL_DIGITAL_FLAG,
a.DOMINANT_ATTRBUTE_FUNDS_IN,
a.DOMINANT_ATTRBUTE_FUNDS_OUT,
a.R12_active_breakup,
a.MYWU_status_1 as MYWU_status,

case 
    when a.RFM_PERSONA IN ('1.LOYALS','2.ENGAGED','3.PROMISING') then 'MOST ENGAGED'
    when a.RFM_PERSONA = '4.WHALES' then 'WHALES'
    when a.RFM_PERSONA = '5.SPORADICS' then 'BUILD HABIT'
    when a.RFM_PERSONA IN ('6.SLIPPING','7.LOST') then 'LOSING TOUCH'
    when a.RFM_PERSONA = '8.ONE AND DONES' then 'ONE TIMERS'
    else 'N/A' end as CONSOLIDATED_PERSONA,

case
    when a.DOMINANT_CORRIDOR_TYPE_1 = 'INTERNATIONAL' then 'IMT'
    when a.DOMINANT_CORRIDOR_TYPE_1 = 'DOMESTIC' then 'DMT' 
      else 'R12_INACTIVE'  end as DOMINANT_CORRIDOR_TYPE,

--R12 Metrices
AQUISITION,
WINBACK,
CHURNS,
R12_ACTIVE,
R1_Cust,
RETAINED_IN_TWO_MONTHS,
RETAINED_CUST,
R1_TXNS,
R12_TXNS,
R1_PRINCIPAL,
R12_PRINCIPAL,
R1_REVENUE,
R12_REVENUE,
R1_FEE,
R12_FEE ,
R1_NET_FX,
R12_NET_FX,

--PR12 Metrices
PR12_ACTIVE,
PR1_Cust,
Retained_Cust_New,

PR1_TXNS,
PR12_TXNS,
PR1_PRINCIPAL,
PR12_PRINCIPAL,
PR1_REVENUE,
PR12_REVENUE,
PR1_FEE,
PR12_FEE ,
PR1_NET_FX,
PR12_NET_FX,
PR1_AQUISITION,
PR1_WINBACK,
PR1_CHURN


from Country_Packet_DATA_AGGREGATED_Dimension_Base a

left join Country_Packet_CUST_LEVEL_DATA_AGGREGATED_R12 b
	on nvl(a.REGION ,'NA') =  nvl(b.REGION,'NA') and
	nvl(a.COUNTRY_NAME ,'NA') =  nvl(b.COUNTRY_NAME,'NA') and
	nvl(a.RFM_PERSONA ,'NA') =  nvl(b.RFM_PERSONA,'NA') and
	nvl(a.DOMINANT_CORRIDOR ,'NA') =  nvl(b.DOMINANT_CORRIDOR,'NA') and
	nvl(a.DOMINANT_AGENT ,'DIGITAL') =  nvl(b.DOMINANT_AGENT,'DIGITAL') and
	nvl(a.DOMINANT_AGENT_DMA ,'DIGITAL') =  nvl(b.DOMINANT_AGENT_DMA,'DIGITAL') and
	nvl(a.DOMINANT_RCV_AGENT ,'DIGITAL') =  nvl(b.DOMINANT_RCV_AGENT,'DIGITAL') and
	nvl(a.DOMINANT_CHANNEL ,'NA') =  nvl(b.DOMINANT_CHANNEL,'NA') and
	nvl(a.FLAG_CONTACTABLE ,'NA') =  nvl(b.FLAG_CONTACTABLE,'NA') and
	nvl(a.EMAIL_SMS_MARKETABLE ,'NA') =  nvl(b.EMAIL_SMS_MARKETABLE,'NA') and
	nvl(a.RETAIL_DIGITAL_FLAG ,'NA') =  nvl(b.RETAIL_DIGITAL_FLAG,'NA') and
	nvl(a.DOMINANT_ATTRBUTE_FUNDS_IN ,'NA') =  nvl(b.DOMINANT_ATTRBUTE_FUNDS_IN,'NA') and
	nvl(a.DOMINANT_ATTRBUTE_FUNDS_OUT ,'NA') =  nvl(b.DOMINANT_ATTRBUTE_FUNDS_OUT,'NA') and
	nvl(a.R12_active_breakup ,'NA') =  nvl(b.R12_active_breakup,'NA') and
	nvl(a.DOMINANT_SNDCOUNTRY_NAME ,'NA') =  nvl(b.DOMINANT_SNDCOUNTRY_NAME,'NA') and
	nvl(a.DOMINANT_RCVCOUNTRY_NAME ,'NA') =  nvl(b.DOMINANT_RCVCOUNTRY_NAME,'NA') and
    nvl(a.MYWU_STATUS_1,'NA') =  nvl(b.MYWU_STATUS_1,'NA') and
    nvl(a.DOMINANT_CORRIDOR_TYPE_1,'NA') =  nvl(b.DOMINANT_CORRIDOR_TYPE_1,'NA') and
	a.MTH_YR = b.MTH_YR

left join Country_Packet_CUST_LEVEL_DATA_AGGREGATED_PR12 c
	on nvl(a.REGION ,'NA') =  nvl(c.REGION,'NA') and
	nvl(a.COUNTRY_NAME ,'NA') =  nvl(c.COUNTRY_NAME,'NA') and
	nvl(a.RFM_PERSONA ,'NA') =  nvl(c.RFM_PERSONA,'NA') and
	nvl(a.DOMINANT_CORRIDOR ,'NA') =  nvl(c.DOMINANT_CORRIDOR,'NA') and
	nvl(a.DOMINANT_AGENT ,'DIGITAL') =  nvl(c.DOMINANT_AGENT,'DIGITAL') and
	nvl(a.DOMINANT_AGENT_DMA ,'DIGITAL') =  nvl(c.DOMINANT_AGENT_DMA,'DIGITAL') and
	nvl(a.DOMINANT_RCV_AGENT ,'DIGITAL') =  nvl(c.DOMINANT_RCV_AGENT,'DIGITAL') and
	nvl(a.DOMINANT_CHANNEL ,'NA') =  nvl(c.DOMINANT_CHANNEL,'NA') and
	nvl(a.FLAG_CONTACTABLE ,'NA') =  nvl(c.FLAG_CONTACTABLE,'NA') and
	nvl(a.EMAIL_SMS_MARKETABLE ,'NA') =  nvl(c.EMAIL_SMS_MARKETABLE,'NA') and
	nvl(a.RETAIL_DIGITAL_FLAG ,'NA') =  nvl(c.RETAIL_DIGITAL_FLAG,'NA') and
	nvl(a.DOMINANT_ATTRBUTE_FUNDS_IN ,'NA') =  nvl(c.DOMINANT_ATTRBUTE_FUNDS_IN,'NA') and
	nvl(a.DOMINANT_ATTRBUTE_FUNDS_OUT ,'NA') =  nvl(c.DOMINANT_ATTRBUTE_FUNDS_OUT,'NA') and
	nvl(a.R12_active_breakup ,'NA') =  nvl(c.R12_active_breakup,'NA') and
	nvl(a.DOMINANT_SNDCOUNTRY_NAME ,'NA') =  nvl(c.DOMINANT_SNDCOUNTRY_NAME,'NA') and
	nvl(a.DOMINANT_RCVCOUNTRY_NAME ,'NA') =  nvl(c.DOMINANT_RCVCOUNTRY_NAME,'NA') and
    nvl(a.MYWU_STATUS_1,'NA') =  nvl(c.MYWU_STATUS_1,'NA') and
    nvl(a.DOMINANT_CORRIDOR_TYPE_1,'NA') =  nvl(c.DOMINANT_CORRIDOR_TYPE_1,'NA') and
	a.MTH_YR = c.MTH_YR;
