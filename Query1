WITH CombinedEmployeeData AS (
    SELECT
        t1.[ObjectName1],
        CASE
            WHEN t2.[Int1] = 0 THEN t2.[Text12]
            ELSE CAST(t2.[Int1] AS NVARCHAR)
        END AS EmployeeID,
        t2.[PersonnelTypeID],
        t3.[Name] AS PersonnelTypeName,
        t1.Objectidentity1 AS EmployeeIdentity,
        t1.PartitionName2 AS Location,
        DATEADD(MINUTE, -1 * t1.[MessageLocaleOffset], t1.[MessageUTC]) AS LocaleMessageTime,
        t1.MessageType,
        t1.XMLGuid
    FROM
        [ACVSUJournal_00010027].[dbo].[ACVSUJournalLog] AS t1
    INNER JOIN
        [ACVSCore].[Access].[Personnel] AS t2
        ON t1.ObjectIdentity1 = t2.GUID
    INNER JOIN
        [ACVSCore].[Access].[PersonnelType] AS t3
        ON t2.PersonnelTypeID = t3.ObjectID
    WHERE
        t1.MessageType = 'CardAdmitted'
        AND t1.PartitionName2 = 'APAC.Default'
        AND DATEADD(MINUTE, -1 * t1.[MessageLocaleOffset], t1.[MessageUTC]) >= '2025-01-01'
)

SELECT TOP 10
    c.LocaleMessageTime,
    x.Value AS Direction
FROM
    CombinedEmployeeData c
INNER JOIN 
    [ACVSUJournal_00010020].[dbo].[ACVSUJournalLogxmlShred] AS x
    ON c.XMLGuid = x.GUID
WHERE
    c.PersonnelTypeName = 'Employee'
    AND c.PartitionName2 = 'APAC.Default'
    AND x.Value = 'OutDirection'
    AND c.LocaleMessageTime >= '2025-01-01'
ORDER BY 
    c.LocaleMessageTime DESC;
