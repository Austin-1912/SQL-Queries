SELECT   COUNT(DISTINCT c.customer_key) AS rnt_customer_count
FROM (
    SELECT 
    cm.customer_key,
    cm.first_registration_date,
    cm.country_code
  FROM SUMMARY_GEN.WUDNA_CUSTOMER_MASTER_VW cm
  JOIN SUMMARY_GEN.COUNTRY_VW cnt
    ON cm.country_code = cnt.country_code
   AND cnt.super_region = 'LACA'
  WHERE --UPPER(cm.country_code) = 'AR' and
    cm.first_registration_date IS NOT NULL
    --AND cm.first_registration_date BETWEEN '2024-10-01' AND '2025-09-30 23:59:59'
    AND DATE(cm.first_registration_date) >= '2024-10-01' AND 
  DATE(cm.first_registration_date) <= '2025-09-30'
) c
LEFT JOIN (
  SELECT DISTINCT
    t.sndcustomer_key
  FROM SUMMARY_GEN.WUDNA_TXN_MASTER_ANALYTICS_VW t
  -- JOIN SUMMARY_GEN.COUNTRY_VW snd
  --   ON t.sndcountry_code = snd.country_code
   where t.SEND_SUPER_REGION = 'LACA'
  --AND t.rcvpaying_datetime BETWEEN '2021-10-01' AND '2025-09-30 23:59:59'
  AND DATE(t.rcvpaying_datetime) >= '2021-10-01' AND 
  DATE(t.rcvpaying_datetime) <= '2025-09-30'
) t
  ON c.customer_key = t.sndcustomer_key
WHERE t.sndcustomer_key IS NULL ;

Could you tell me what is the difference between the logic of the first query and the one given below and shouldnt they work 
the same.
CREATE OR REPLACE TABLE LACA_RNT_CUSTOMERS1 AS
WITH 
-- Generate months from Jan 2024 up to the last completed month
months AS (
  SELECT DISTINCT DATE_TRUNC('MONTH', MTH_YR) AS ref_date
  FROM WUDNA.CEX_SANDBOX.VA_KPI_2020_2
  WHERE MTH_YR >= TO_DATE('2024-01-01')
    AND MTH_YR < DATE_TRUNC('MONTH', CURRENT_DATE)
),

-- Registered LACA customers with marketability flags
cust_reg AS (
  SELECT
    c.customer_key,
    DATE_TRUNC('MONTH', c.first_registration_date) AS reg_month,
    c.country_code,
    CASE
      WHEN c.email_address_on_file_flag = 'Y'
       AND c.opt_email = 'I'
       AND c.marketing_flag = 'Y'
      THEN 'Y'
      ELSE 'N'
    END AS email_marketable,
    CASE
      WHEN (c.opt_sms = 'I'
        AND c.mobile_number_on_file_flag = 'Y'
        AND c.marketing_flag = 'Y'
        AND c.country_code NOT IN ('US','CA'))
      OR (c.mobile_number_on_file_flag = 'Y'
        AND c.opt_sms = 'I'
        AND c.double_opt_sms = 'I'
        AND c.marketing_flag = 'Y'
        AND c.country_code IN ('US','CA'))
      THEN 'Y'
      ELSE 'N'
    END AS sms_marketable
  FROM SUMMARY_GEN.WUDNA_CUSTOMER_MASTER_VW c
  JOIN SUMMARY_GEN.COUNTRY_VW cnt
    ON c.country_code = cnt.country_code
   AND cnt.super_region = 'LACA'
  WHERE c.first_registration_date IS NOT NULL
),

-- All LACA transactions from 2021 onwards
all_txns AS (
  SELECT DISTINCT
    t.sndcustomer_key AS customer_key,
    DATE(t.rcvpaying_datetime) AS txn_date
  FROM SUMMARY_GEN.WUDNA_TXN_MASTER_ANALYTICS_VW t
  WHERE t.SEND_SUPER_REGION = 'LACA'
    AND t.rcvpaying_datetime >= '2021-01-01'
)

-- Final RNT: Registered in R12, No transactions in R48
SELECT DISTINCT
  m.ref_date,
  r.customer_key,
  r.country_code,
  r.reg_month,
  'Y' AS rnt_flag,
  r.email_marketable,
  r.sms_marketable
FROM months m
JOIN cust_reg r
  ON r.reg_month >= DATEADD(MONTH, -11, m.ref_date)  -- R12 start
 AND r.reg_month <= m.ref_date                       -- R12 end
LEFT JOIN all_txns t
  ON r.customer_key = t.customer_key
 AND t.txn_date >= DATEADD(MONTH, -47, m.ref_date)  -- R48 start
 AND t.txn_date <= LAST_DAY(m.ref_date)            -- R48 end
WHERE t.customer_key IS NULL; 

Also i am running the below validations to get the customer keys which are missing from the Main RNT logic 
but present in the validation RNT Logic.

-- Get customer keys from validation logic
SELECT DISTINCT c.customer_key
FROM (
    SELECT 
      cm.customer_key,
      cm.first_registration_date,
      cm.country_code
    FROM SUMMARY_GEN.WUDNA_CUSTOMER_MASTER_VW cm
    JOIN SUMMARY_GEN.COUNTRY_VW cnt
      ON cm.country_code = cnt.country_code
     AND cnt.super_region = 'LACA'
    WHERE cm.first_registration_date IS NOT NULL
      AND DATE(cm.first_registration_date) >= '2024-10-01'
      AND DATE(cm.first_registration_date) <= '2025-09-30'
) c
LEFT JOIN (
  SELECT DISTINCT
    t.sndcustomer_key,
    t.rcvpaying_datetime
  FROM SUMMARY_GEN.WUDNA_TXN_MASTER_ANALYTICS_VW t
  WHERE t.SEND_SUPER_REGION = 'LACA'
    AND DATE(t.rcvpaying_datetime) >= '2021-10-01'
    AND DATE(t.rcvpaying_datetime) <= '2025-09-30'
) t
  ON c.customer_key = t.sndcustomer_key
WHERE t.sndcustomer_key IS NULL

MINUS

-- Customer keys already in the RNT table
SELECT DISTINCT customer_key
FROM LACA_RNT_CUSTOMERS1_TEST_AM
WHERE ref_date = TO_DATE('2025-09-01');




