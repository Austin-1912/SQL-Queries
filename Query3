I'll create a series of table creation statements to build up the analysis step by step, following your data sources and requirements.

```sql
-- Step 1: Create base customer table (Active R12 US customers)
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_BASE_CUSTOMERS AS
SELECT 
    CUSTOMER_KEY,
    COUNTRY_CODE,
    Age AS AGE_GROUP,
    PRFRD_LANGUAGE_CODE
FROM WUDNA.SUMMARY_GEN.WUDNA_CUSTOMER_MASTER_VW
WHERE COUNTRY_CODE = 'US'
    AND CUSTOMER_KEY IS NOT NULL;

-- Step 2: Create Prepaid Card transactions table
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_PREPAID_TXNS AS
SELECT 
    CUSTOMER_KEY,
    SETTLEMENT_DATE,
    TOTAL_AMOUNT,
    CARDTRANSACTIONTYPE,
    STATE,
    COUNT(*) AS TXN_COUNT,
    SUM(TOTAL_AMOUNT) AS TOTAL_VOLUME
FROM WUDNA.SUMMARY_GEN.WUDNA_PREPAID_TXN_VW
WHERE CARDTRANSACTIONTYPE = 'Prepaid Card Payment'
    AND SETTLEMENT_DATE BETWEEN '2024-12-01' AND '2025-11-30'
    AND CUSTOMER_KEY IS NOT NULL
GROUP BY 
    CUSTOMER_KEY,
    SETTLEMENT_DATE,
    TOTAL_AMOUNT,
    CARDTRANSACTIONTYPE,
    STATE;

-- Step 3: Create Bill Pay transactions table
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_BILLPAY_TXNS AS
SELECT 
    SNDCUSTOMER_KEY AS CUSTOMER_KEY,
    RCVPAYING_DATETIME,
    SNDPRINCIPAL_USD,
    PRODUCT_GROUP,
    CASE
        WHEN UPPER(PRICING_CHANNEL) IN ('WEB','APP') THEN 'Digital'
        WHEN UPPER(PRICING_CHANNEL) IN ('POS','TMT','AIR') THEN 'Retail'
        ELSE 'Other'
    END AS CHANNEL,
    CASE
        WHEN UPPER(PRICING_CHANNEL) = 'WEB' THEN 'Web'
        WHEN UPPER(PRICING_CHANNEL) = 'APP' THEN 'App'
        ELSE NULL
    END AS DIGITAL_SUBCHANNEL,
    COUNT(*) AS TXN_COUNT,
    SUM(SNDPRINCIPAL_USD) AS TOTAL_VOLUME
FROM WUDNA.SUMMARY_GEN.WUDNA_TXN_MASTER_VW
WHERE PRODUCT_GROUP IN ('QCOL','QCSH')
    AND SNDCOUNTRY_CODE = 'US'
    AND RCVPAYING_DATETIME BETWEEN '2024-12-01' AND '2025-11-30'
    AND SNDCUSTOMER_KEY IS NOT NULL
GROUP BY 
    SNDCUSTOMER_KEY,
    RCVPAYING_DATETIME,
    SNDPRINCIPAL_USD,
    PRODUCT_GROUP,
    PRICING_CHANNEL;

-- Step 4: Create Money Transfer transactions table
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_MT_TXNS AS
SELECT 
    SNDCUSTOMER_KEY AS CUSTOMER_KEY,
    RCVPAYING_DATETIME,
    SNDPRINCIPAL_USD,
    ATTRIBUTE_CHANNEL,
    SEND_STATE,
    CASE
        WHEN UPPER(ATTRIBUTE_CHANNEL) IN ('RETAIL','POS','TMT','AIR') THEN 'Retail'
        WHEN UPPER(ATTRIBUTE_CHANNEL) IN ('DIGITAL','WEB','APP') THEN 'Digital'
        ELSE 'Other'
    END AS CHANNEL,
    CASE
        WHEN UPPER(ATTRIBUTE_CHANNEL) = 'WEB' THEN 'Web'
        WHEN UPPER(ATTRIBUTE_CHANNEL) = 'APP' THEN 'App'
        ELSE NULL
    END AS DIGITAL_SUBCHANNEL,
    COUNT(*) AS TXN_COUNT,
    SUM(SNDPRINCIPAL_USD) AS TOTAL_VOLUME
FROM WUDNA.SUMMARY_GEN.WUDNA_TXN_MASTER_VW
WHERE PRODUCT_GROUP = 'MTRN'
    AND SNDCOUNTRY_CODE = 'US'
    AND RCVPAYING_DATETIME BETWEEN '2024-12-01' AND '2025-11-30'
    AND SNDCUSTOMER_KEY IS NOT NULL
GROUP BY 
    SNDCUSTOMER_KEY,
    RCVPAYING_DATETIME,
    SNDPRINCIPAL_USD,
    ATTRIBUTE_CHANNEL,
    SEND_STATE;

-- Step 5: Aggregate customer-level product usage
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_CUSTOMER_PRODUCTS AS
SELECT 
    c.CUSTOMER_KEY,
    c.AGE_GROUP,
    c.PRFRD_LANGUAGE_CODE,
    -- Prepaid Card indicators
    CASE WHEN p.CUSTOMER_KEY IS NOT NULL THEN 1 ELSE 0 END AS HAS_PREPAID,
    COALESCE(SUM(p.TXN_COUNT), 0) AS PREPAID_TXN_COUNT,
    COALESCE(SUM(p.TOTAL_VOLUME), 0) AS PREPAID_VOLUME,
    -- Bill Pay indicators
    CASE WHEN b.CUSTOMER_KEY IS NOT NULL THEN 1 ELSE 0 END AS HAS_BILLPAY,
    COALESCE(SUM(b.TXN_COUNT), 0) AS BILLPAY_TXN_COUNT,
    COALESCE(SUM(b.TOTAL_VOLUME), 0) AS BILLPAY_VOLUME,
    -- Money Transfer indicators
    CASE WHEN m.CUSTOMER_KEY IS NOT NULL THEN 1 ELSE 0 END AS HAS_MT,
    COALESCE(SUM(m.TXN_COUNT), 0) AS MT_TXN_COUNT,
    COALESCE(SUM(m.TOTAL_VOLUME), 0) AS MT_VOLUME
FROM WUDNA.CEX_SANDBOX.C2B_BASE_CUSTOMERS c
LEFT JOIN (
    SELECT CUSTOMER_KEY, SUM(TXN_COUNT) AS TXN_COUNT, SUM(TOTAL_VOLUME) AS TOTAL_VOLUME
    FROM WUDNA.CEX_SANDBOX.C2B_PREPAID_TXNS
    GROUP BY CUSTOMER_KEY
) p ON c.CUSTOMER_KEY = p.CUSTOMER_KEY
LEFT JOIN (
    SELECT CUSTOMER_KEY, SUM(TXN_COUNT) AS TXN_COUNT, SUM(TOTAL_VOLUME) AS TOTAL_VOLUME
    FROM WUDNA.CEX_SANDBOX.C2B_BILLPAY_TXNS
    GROUP BY CUSTOMER_KEY
) b ON c.CUSTOMER_KEY = b.CUSTOMER_KEY
LEFT JOIN (
    SELECT CUSTOMER_KEY, SUM(TXN_COUNT) AS TXN_COUNT, SUM(TOTAL_VOLUME) AS TOTAL_VOLUME
    FROM WUDNA.CEX_SANDBOX.C2B_MT_TXNS
    GROUP BY CUSTOMER_KEY
) m ON c.CUSTOMER_KEY = m.CUSTOMER_KEY
WHERE p.CUSTOMER_KEY IS NOT NULL 
    OR b.CUSTOMER_KEY IS NOT NULL 
    OR m.CUSTOMER_KEY IS NOT NULL
GROUP BY 
    c.CUSTOMER_KEY,
    c.AGE_GROUP,
    c.PRFRD_LANGUAGE_CODE,
    p.CUSTOMER_KEY,
    b.CUSTOMER_KEY,
    m.CUSTOMER_KEY;

-- Step 6: Create customer segmentation table
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_CUSTOMER_SEGMENTS AS
SELECT 
    CUSTOMER_KEY,
    AGE_GROUP,
    PRFRD_LANGUAGE_CODE,
    HAS_PREPAID,
    HAS_BILLPAY,
    HAS_MT,
    PREPAID_TXN_COUNT,
    PREPAID_VOLUME,
    BILLPAY_TXN_COUNT,
    BILLPAY_VOLUME,
    MT_TXN_COUNT,
    MT_VOLUME,
    -- Customer segment categorization
    CASE 
        WHEN (HAS_PREPAID = 1 OR HAS_BILLPAY = 1) AND HAS_MT = 0 THEN 'C2B Only'
        WHEN (HAS_PREPAID = 1 OR HAS_BILLPAY = 1) AND HAS_MT = 1 THEN 'C2B + Money Transfer'
        WHEN (HAS_PREPAID = 0 AND HAS_BILLPAY = 0) AND HAS_MT = 1 THEN 'Money Transfer Only'
        ELSE 'Other'
    END AS CUSTOMER_SEGMENT,
    -- Specific product combinations
    CASE 
        WHEN HAS_PREPAID = 1 AND HAS_BILLPAY = 0 AND HAS_MT = 0 THEN 'Prepaid Only'
        WHEN HAS_PREPAID = 0 AND HAS_BILLPAY = 1 AND HAS_MT = 0 THEN 'Bill Pay Only'
        WHEN HAS_PREPAID = 1 AND HAS_BILLPAY = 1 AND HAS_MT = 0 THEN 'Prepaid + Bill Pay'
        WHEN HAS_PREPAID = 1 AND HAS_BILLPAY = 0 AND HAS_MT = 1 THEN 'Prepaid + MT'
        WHEN HAS_PREPAID = 0 AND HAS_BILLPAY = 1 AND HAS_MT = 1 THEN 'Bill Pay + MT'
        WHEN HAS_PREPAID = 1 AND HAS_BILLPAY = 1 AND HAS_MT = 1 THEN 'All Products'
        WHEN HAS_PREPAID = 0 AND HAS_BILLPAY = 0 AND HAS_MT = 1 THEN 'MT Only'
        ELSE 'Other'
    END AS PRODUCT_COMBINATION
FROM WUDNA.CEX_SANDBOX.C2B_CUSTOMER_PRODUCTS;

-- Step 7: Create geography aggregation for C2B products
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_GEOGRAPHY_PREPAID AS
SELECT 
    p.CUSTOMER_KEY,
    p.STATE,
    COUNT(*) AS TXN_COUNT,
    ROW_NUMBER() OVER (PARTITION BY p.CUSTOMER_KEY ORDER BY COUNT(*) DESC) AS STATE_RANK
FROM WUDNA.CEX_SANDBOX.C2B_PREPAID_TXNS p
GROUP BY p.CUSTOMER_KEY, p.STATE;

CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_GEOGRAPHY_MT AS
SELECT 
    m.CUSTOMER_KEY,
    m.SEND_STATE AS STATE,
    COUNT(*) AS TXN_COUNT,
    ROW_NUMBER() OVER (PARTITION BY m.CUSTOMER_KEY ORDER BY COUNT(*) DESC) AS STATE_RANK
FROM WUDNA.CEX_SANDBOX.C2B_MT_TXNS m
GROUP BY m.CUSTOMER_KEY, m.SEND_STATE;

-- Step 8: Create dominant state table for each customer
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_CUSTOMER_DOMINANT_STATE AS
SELECT 
    COALESCE(p.CUSTOMER_KEY, m.CUSTOMER_KEY) AS CUSTOMER_KEY,
    CASE 
        WHEN p.TXN_COUNT > COALESCE(m.TXN_COUNT, 0) THEN p.STATE
        WHEN m.TXN_COUNT > COALESCE(p.TXN_COUNT, 0) THEN m.STATE
        ELSE COALESCE(p.STATE, m.STATE)
    END AS DOMINANT_STATE
FROM (
    SELECT CUSTOMER_KEY, STATE, TXN_COUNT 
    FROM WUDNA.CEX_SANDBOX.C2B_GEOGRAPHY_PREPAID 
    WHERE STATE_RANK = 1
) p
FULL OUTER JOIN (
    SELECT CUSTOMER_KEY, STATE, TXN_COUNT 
    FROM WUDNA.CEX_SANDBOX.C2B_GEOGRAPHY_MT 
    WHERE STATE_RANK = 1
) m ON p.CUSTOMER_KEY = m.CUSTOMER_KEY;

-- Step 9: Create channel aggregation for Bill Pay and MT
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_CHANNEL_BILLPAY AS
SELECT 
    CUSTOMER_KEY,
    CHANNEL,
    DIGITAL_SUBCHANNEL,
    SUM(TXN_COUNT) AS TXN_COUNT,
    SUM(TOTAL_VOLUME) AS TOTAL_VOLUME
FROM WUDNA.CEX_SANDBOX.C2B_BILLPAY_TXNS
GROUP BY CUSTOMER_KEY, CHANNEL, DIGITAL_SUBCHANNEL;

CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_CHANNEL_MT AS
SELECT 
    CUSTOMER_KEY,
    CHANNEL,
    DIGITAL_SUBCHANNEL,
    SUM(TXN_COUNT) AS TXN_COUNT,
    SUM(TOTAL_VOLUME) AS TOTAL_VOLUME
FROM WUDNA.CEX_SANDBOX.C2B_MT_TXNS
GROUP BY CUSTOMER_KEY, CHANNEL, DIGITAL_SUBCHANNEL;

-- Step 10: Create dominant channel table
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_CUSTOMER_DOMINANT_CHANNEL AS
SELECT 
    CUSTOMER_KEY,
    CHANNEL AS DOMINANT_CHANNEL,
    DIGITAL_SUBCHANNEL AS DOMINANT_DIGITAL_SUBCHANNEL,
    TXN_COUNT
FROM (
    SELECT 
        CUSTOMER_KEY,
        CHANNEL,
        DIGITAL_SUBCHANNEL,
        TXN_COUNT,
        ROW_NUMBER() OVER (PARTITION BY CUSTOMER_KEY ORDER BY TXN_COUNT DESC) AS CHANNEL_RANK
    FROM (
        SELECT CUSTOMER_KEY, CHANNEL, DIGITAL_SUBCHANNEL, SUM(TXN_COUNT) AS TXN_COUNT
        FROM (
            SELECT CUSTOMER_KEY, CHANNEL, DIGITAL_SUBCHANNEL, TXN_COUNT
            FROM WUDNA.CEX_SANDBOX.C2B_CHANNEL_BILLPAY
            UNION ALL
            SELECT CUSTOMER_KEY, CHANNEL, DIGITAL_SUBCHANNEL, TXN_COUNT
            FROM WUDNA.CEX_SANDBOX.C2B_CHANNEL_MT
        )
        GROUP BY CUSTOMER_KEY, CHANNEL, DIGITAL_SUBCHANNEL
    )
)
WHERE CHANNEL_RANK = 1;

-- Step 11: Get dominant agent from existing table
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_CUSTOMER_DOMINANT_AGENT AS
SELECT 
    CUSTOMER_KEY,
    DOMINANT_AGENT_STATE
FROM WUDNA.CEX_SANDBOX.SK_DOMINANCY_METRICS
WHERE CUSTOMER_KEY IS NOT NULL;

-- Step 12: Create final master table with all attributes
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_CUSTOMER_MASTER_ANALYSIS AS
SELECT 
    seg.CUSTOMER_KEY,
    seg.CUSTOMER_SEGMENT,
    seg.PRODUCT_COMBINATION,
    seg.AGE_GROUP,
    seg.PRFRD_LANGUAGE_CODE,
    seg.HAS_PREPAID,
    seg.PREPAID_TXN_COUNT,
    seg.PREPAID_VOLUME,
    seg.HAS_BILLPAY,
    seg.BILLPAY_TXN_COUNT,
    seg.BILLPAY_VOLUME,
    seg.HAS_MT,
    seg.MT_TXN_COUNT,
    seg.MT_VOLUME,
    geo.DOMINANT_STATE,
    ch.DOMINANT_CHANNEL,
    ch.DOMINANT_DIGITAL_SUBCHANNEL,
    ag.DOMINANT_AGENT_STATE
FROM WUDNA.CEX_SANDBOX.C2B_CUSTOMER_SEGMENTS seg
LEFT JOIN WUDNA.CEX_SANDBOX.C2B_CUSTOMER_DOMINANT_STATE geo 
    ON seg.CUSTOMER_KEY = geo.CUSTOMER_KEY
LEFT JOIN WUDNA.CEX_SANDBOX.C2B_CUSTOMER_DOMINANT_CHANNEL ch 
    ON seg.CUSTOMER_KEY = ch.CUSTOMER_KEY
LEFT JOIN WUDNA.CEX_SANDBOX.C2B_CUSTOMER_DOMINANT_AGENT ag 
    ON seg.CUSTOMER_KEY = ag.CUSTOMER_KEY;

-- Step 13: Create summary statistics table by segment
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_SEGMENT_SUMMARY AS
SELECT 
    CUSTOMER_SEGMENT,
    PRODUCT_COMBINATION,
    COUNT(DISTINCT CUSTOMER_KEY) AS CUSTOMER_COUNT,
    -- Demographics
    COUNT(DISTINCT AGE_GROUP) AS UNIQUE_AGE_GROUPS,
    COUNT(DISTINCT PRFRD_LANGUAGE_CODE) AS UNIQUE_LANGUAGES,
    -- Geography
    COUNT(DISTINCT DOMINANT_STATE) AS UNIQUE_STATES,
    -- Channel
    COUNT(DISTINCT DOMINANT_CHANNEL) AS UNIQUE_CHANNELS,
    SUM(CASE WHEN DOMINANT_CHANNEL = 'Digital' THEN 1 ELSE 0 END) AS DIGITAL_CUSTOMERS,
    SUM(CASE WHEN DOMINANT_CHANNEL = 'Retail' THEN 1 ELSE 0 END) AS RETAIL_CUSTOMERS,
    -- Transaction volumes
    SUM(PREPAID_TXN_COUNT) AS TOTAL_PREPAID_TXNS,
    SUM(PREPAID_VOLUME) AS TOTAL_PREPAID_VOLUME,
    SUM(BILLPAY_TXN_COUNT) AS TOTAL_BILLPAY_TXNS,
    SUM(BILLPAY_VOLUME) AS TOTAL_BILLPAY_VOLUME,
    SUM(MT_TXN_COUNT) AS TOTAL_MT_TXNS,
    SUM(MT_VOLUME) AS TOTAL_MT_VOLUME,
    -- Averages
    AVG(PREPAID_VOLUME) AS AVG_PREPAID_VOLUME,
    AVG(BILLPAY_VOLUME) AS AVG_BILLPAY_VOLUME,
    AVG(MT_VOLUME) AS AVG_MT_VOLUME
FROM WUDNA.CEX_SANDBOX.C2B_CUSTOMER_MASTER_ANALYSIS
GROUP BY CUSTOMER_SEGMENT, PRODUCT_COMBINATION
ORDER BY CUSTOMER_COUNT DESC;

-- Step 14: Create demographic breakdown by segment
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_DEMOGRAPHICS_BY_SEGMENT AS
SELECT 
    CUSTOMER_SEGMENT,
    AGE_GROUP,
    PRFRD_LANGUAGE_CODE,
    COUNT(DISTINCT CUSTOMER_KEY) AS CUSTOMER_COUNT,
    SUM(PREPAID_VOLUME + BILLPAY_VOLUME + MT_VOLUME) AS TOTAL_VOLUME
FROM WUDNA.CEX_SANDBOX.C2B_CUSTOMER_MASTER_ANALYSIS
GROUP BY CUSTOMER_SEGMENT, AGE_GROUP, PRFRD_LANGUAGE_CODE
ORDER BY CUSTOMER_SEGMENT, CUSTOMER_COUNT DESC;

-- Step 15: Create geographic breakdown by segment
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_GEOGRAPHY_BY_SEGMENT AS
SELECT 
    CUSTOMER_SEGMENT,
    DOMINANT_STATE,
    COUNT(DISTINCT CUSTOMER_KEY) AS CUSTOMER_COUNT,
    SUM(PREPAID_VOLUME + BILLPAY_VOLUME + MT_VOLUME) AS TOTAL_VOLUME
FROM WUDNA.CEX_SANDBOX.C2B_CUSTOMER_MASTER_ANALYSIS
WHERE DOMINANT_STATE IS NOT NULL
GROUP BY CUSTOMER_SEGMENT, DOMINANT_STATE
ORDER BY CUSTOMER_SEGMENT, CUSTOMER_COUNT DESC;

-- Step 16: Create channel breakdown by segment
CREATE OR REPLACE TABLE WUDNA.CEX_SANDBOX.C2B_CHANNEL_BY_SEGMENT AS
SELECT 
    CUSTOMER_SEGMENT,
    DOMINANT_CHANNEL,
    DOMINANT_DIGITAL_SUBCHANNEL,
    COUNT(DISTINCT CUSTOMER_KEY) AS CUSTOMER_COUNT,
    SUM(PREPAID_VOLUME + BILLPAY_VOLUME + MT_VOLUME) AS TOTAL_VOLUME
FROM WUDNA.CEX_SANDBOX.C2B_CUSTOMER_MASTER_ANALYSIS
GROUP BY CUSTOMER_SEGMENT, DOMINANT_CHANNEL, DOMINANT_DIGITAL_SUBCHANNEL
ORDER BY CUSTOMER_SEGMENT, CUSTOMER_COUNT DESC;
```

This creates a comprehensive set of tables that will allow you to analyze:

1. **Customer segmentation**: C2B Only, C2B + Money Transfer, Money Transfer Only
2. **Specific product combinations**: Prepaid Only, Bill Pay Only, combinations, etc.
3. **Demographics**: Age groups and language preferences by segment
4. **Geography**: Dominant states where customers transact by segment
5. **Channel usage**: Retail vs Digital, and Web vs App breakdown
6. **Transaction volumes and counts**: For each product type by segment

The final master table `C2B_CUSTOMER_MASTER_ANALYSIS` contains all customer-level attributes, and the summary tables provide aggregated insights for reporting.
