i have written this code on sql and exported to excel and also connect in power bi and want show the rank like which employee has the most number of swipes in the month,
and also top 10 managers who have the highest number of swipes .
So basically two layers first would be top 10 managers with the total swipes for their team, and second layer having the top 10 employees under 
those manager who have the highest number 
of swipes it should be ranked also over the  top 10 employeess with their managers. 
DECLARE @TargetYear INT = 2025;
DECLARE @TargetMonth INT = 7;

WITH CombinedQuery AS (
    SELECT 
        DATEADD(MINUTE, -1 * t1.[MessageLocaleOffset], t1.[MessageUTC]) AS LocaleMessageTime,
        t1.ObjectName1, -- Employee Name
        t1.PartitionName2 AS location,
        t5_card.CardNumber,
        t5_admit.value AS AdmitCode,
        t5_dir.value AS Direction,
        t1.ObjectName2,
        CASE 
            WHEN t3.Name IN ('Contractor', 'Terminated Contractor') THEN t2.Text12
            ELSE CAST(t2.Int1 AS NVARCHAR)
        END AS EmployeeID,
        t3.Name AS PersonnelType,
		t2.Text10 AS ManagerName,
        t1.PartitionName2,
        t1.MessageType,
        t1.XmlGUID
    FROM
        ACVSUJournal_00010028.[dbo].[ACVSUJournalLog] AS t1
    LEFT JOIN
        [ACVSCore].[Access].[Personnel] AS t2 ON t1.ObjectIdentity1 = t2.GUID
    LEFT JOIN
        [ACVSCore].[Access].[PersonnelType] AS t3 ON t2.[PersonnelTypeId] = t3.[ObjectID]
    LEFT JOIN
        ACVSUJournal_00010028.[dbo].[ACVSUJournalLogxmlShred] AS t5_admit
        ON t1.XmlGUID = t5_admit.GUID AND t5_admit.Name = 'AdmitCode'
    LEFT JOIN
        ACVSUJournal_00010028.[dbo].[ACVSUJournalLogxmlShred] AS t5_dir
        ON t1.XmlGUID = t5_dir.GUID AND t5_dir.Value IN ('InDirection', 'OutDirection')
    LEFT JOIN 
        ACVSUJournal_00010028.[dbo].[ACVSUJournalLogxml] AS t_xml ON t1.XmlGUID = t_xml.GUID
    LEFT JOIN (
        SELECT GUID, [value]
        FROM ACVSUJournal_00010028.[dbo].[ACVSUJournalLogxmlShred]
        WHERE [Name] IN ('Card', 'CHUID')
    ) AS SCard ON t1.XmlGUID = SCard.GUID
    OUTER APPLY (
        SELECT COALESCE(
            TRY_CAST(t_xml.XmlMessage AS XML).value('(/LogMessage/CHUID/Card)[1]', 'varchar(50)'),
            TRY_CAST(t_xml.XmlMessage AS XML).value('(/LogMessage/CHUID)[1]', 'varchar(50)'),
            SCard.[value]
        ) AS CardNumber
    ) AS t5_card
    WHERE 
        t1.MessageType = 'CardAdmitted'
        AND t3.Name = 'Employee'
        AND YEAR(DATEADD(MINUTE, -1 * t1.MessageLocaleOffset, t1.MessageUTC)) = @TargetYear
        AND MONTH(DATEADD(MINUTE, -1 * t1.MessageLocaleOffset, t1.MessageUTC)) = @TargetMonth
		AND PartitionName2 = 'APAC.Default'
)

SELECT 
    FORMAT(LocaleMessageTime, 'yyyy-MM') AS Month,
    ObjectName1 AS EmployeeName,
    EmployeeID,
	PersonnelType,
	ManagerName,
    PartitionName2,
    COUNT(*) AS TotalSwipes
FROM CombinedQuery
GROUP BY 
    FORMAT(LocaleMessageTime, 'yyyy-MM'),
    ObjectName1,
    EmployeeID,
	PersonnelType,
	ManagerName,
    PartitionName2
ORDER BY 
    Month DESC,
    EmployeeName;
