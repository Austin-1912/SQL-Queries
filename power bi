create or replace table TOP_50_CORRIDORS_COUNTRY as                            

SELECT MTH_YR, COUNTRY_NAME, DOMINANT__CORRIDOR,

COUNT(CASE WHEN R12_ACTIVE = 'Y' THEN SNDCUSTOMER_KEY END) AS R12_ACTIVE,

ROW_NUMBER() OVER (PARTITION BY MTH_YR, COUNTRY_NAME ORDER BY COUNT(CASE WHEN R12_ACTIVE = 'Y' THEN SNDCUSTOMER_KEY END) DESC) AS TOP_50_DOMINANT_CORRIDOR_RANK

FROM Country_Packet_CUST_LEVEL_R12

where mth_yr <> date_trunc('MONTH',sysdate())

GROUP BY 1,2,3;
 
left join TOP_50_CORRIDORS_COUNTRY CC on CC.MTH_YR = AWC.MTH_YR and CC.DOMINANT__CORRIDOR = AWC.DOMINANT__CORRIDOR and CC.COUNTRY_NAME = AWC.COUNTRY_NAME

 
CASE 

WHEN CC.TOP_50_DOMINANT_CORRIDOR_RANK <= 50 THEN AWC.DOMINANT__CORRIDOR  

ELSE 'Others' END AS DOMINANT_CORRIDOR,
 
HERE  CC.TOP_50_DOMINANT_CORRIDOR_RANK <= 10 
FROM Country_Packet_CUST_LEVEL_R12 table will also change to YN_VA_KPI_2020_OUTPUT_ENGAGEMENT_CUST_LEVEL
and with R12_active = 'Y' 
